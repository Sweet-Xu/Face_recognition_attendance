<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="nchu.stu.attend.system.dao.UserMapper">
  <resultMap id="BaseResultMap" type="nchu.stu.attend.system.domain.User">
    <!--
      WARNING - @mbg.generated
    -->
	  <id column="user_id" jdbcType="DECIMAL" property="userId" />
	  <result column="username" jdbcType="VARCHAR" property="userName" />
	  <result column="password" jdbcType="VARCHAR" property="password" />
	  <result column="gender" jdbcType="CHAR" property="gender" />
	  <result column="college_name" jdbcType="DECIMAL" property="collegeName" />
	  <result column="user_email" jdbcType="VARCHAR" property="userEmail" />
	  <result column="user_picture" jdbcType="VARCHAR" property="userPicture" />
	  <result column="user_status" jdbcType="CHAR" property="status" />
	  <result column="user_create_time" jdbcType="TIMESTAMP" property="userCreateTime" />
	  <result column="last_login_time" jdbcType="TIMESTAMP" property="lastLoginTime" />
  </resultMap>
  
<!--  <select id="findUserWithDept" resultType="user" parameterType="user">-->
<!--  		select u.user_id userId,u.username,u.email,u.mobile,u.status,u.crate_time crateTime,-->
<!--  		u.ssex,d.dept_name deptName from t_user u -->
<!--  		left join t_dept d on(u.dept_id = d.dept_id)-->
<!--  		where 1=1-->
<!--  		<if test="username != null and username != ''">-->
<!--        	AND u.username = #{username}-->
<!--	    </if>-->
<!--	    <if test="deptId != null and deptId != ''">-->
<!--	        AND d.dept_id = #{deptId}-->
<!--	    </if>-->
<!--  		<if test="ssex != null and ssex != ''">-->
<!--	        AND u.ssex = #{ssex}-->
<!--	    </if>-->
<!--	    <if test="status != null and status != ''">-->
<!--	        AND u.status = #{status}-->
<!--	    </if>-->
<!--  		order by u.user_id-->
<!--  </select>-->

	<select id="findAllUser" resultType="user" parameterType="user">
		select u.user_id ,u.username ,u.gender ,u.college_name ,u.user_email ,u.user_picture ,u.user_status ,
		u.user_create_time ,u.last_login_time ,from t_user u
		where 1=1
		<if test="userName != null and userName != ''">
			AND u.username = #{userName}
		</if>
		<if test="collegeName != null and collegeName != ''">
			AND u.college_name = #{collegeName}
		</if>
		<if test="status != null and status != ''">
			AND u.user_status = #{status}
		</if>
		order by u.user_id
	</select>



	<select id="findUserWithRole" resultType="UserWithRole">
		select u.user_id userId,u.username ,u.gender ,u.college_name ,u.user_email ,u.user_picture ,
		u.user_status ,ur.role_id roleId from t_user u
		left join t_user_role ur on (u.user_id = ur.user_id)
		where u.user_id = #{userId}
  </select>
  
<!--  <select id="findUserProfile" resultType="user" parameterType="user">-->
<!--	SELECT-->
<!--		U .USERNAME,-->
<!--		U .USER_ID userId,-->
<!--		D .DEPT_NAME deptName,-->
<!--		U .mobile,-->
<!--		U .email,-->
<!--		U .avatar,-->
<!--		U .description,-->
<!--		U .ssex,-->
<!--		U .dept_id deptId,-->
<!--		group_concat(r.role_name) AS roleName-->
<!--	FROM-->
<!--		t_user U-->
<!--	LEFT JOIN t_dept D ON U .DEPT_ID = D .DEPT_ID-->
<!--	LEFT JOIN t_user_role ur ON U .user_id = ur.user_id-->
<!--	LEFT JOIN t_role r ON r.role_id = ur.role_id-->
<!--	WHERE-->
<!--		U .USER_ID = #{userId}-->
<!--	GROUP BY-->
<!--		U .username,-->
<!--		D .dept_name,-->
<!--		U .mobile,-->
<!--		U .email,-->
<!--		U .avatar,-->
<!--		U .description,-->
<!--		U .ssex,-->
<!--		U .USER_ID,-->
<!--		U .dept_id-->
<!--  </select>-->

	<select id="findUserProfile" resultType="user" parameterType="user" >
	SELECT
		U .username ,
		U .USER_ID userId,
		U .gender ,
		U .college_name ,
		U .user_email ,
		U .user_picture ,
		group_concat(r.role_name) AS roleName
	FROM
		t_user U
	LEFT JOIN t_user_role ur ON U .user_id = ur.user_id
	LEFT JOIN t_role r ON r.role_id = ur.role_id
	WHERE
		U .USER_ID = #{userId}
	GROUP BY
		U .username,
		U .USER_ID,
		U .gender,
		U .college_name,
		U .user_email,
		U .user_picture
  </select>
  
</mapper>